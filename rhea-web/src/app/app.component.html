<!-- ======= Header ======= -->
<header id="header" class="header  d-flex align-items-center" style="background-image: linear-gradient(to right,#012970 12%,#b3cfff , #fff ) ">
  <div class="d-flex align-items-center justify-content-between">
    <a  class="logo d-flex align-items-center">
      <div class="down">
      <h3 class="white-text" >RheaWeb</h3></div>
      <button mat-icon-button (click)="drawer.toggle()"  (click)="(bdrawer=!bdrawer)" >
        <mat-icon class="white-text" >{{bdrawer? 'chevron_right' : 'chevron_left'}}</mat-icon>
      </button>
    </a>
  </div>
  <!-- End Logo -->
  <nav class="header-nav " >
    <div class="row justify-content-end">
      <div class="col-lg-11">
        <div class="left">
        <div class="row justify-content-end">
          
          <div class="col-lg-3  d-md-flex ">
            <img src="../assets/img/logorhea.png" class="img1" alt="Profile">
          </div>
          <div class="col-lg-3  d-md-flex " >
            <a target="_blank" href="https://caosd.lcc.uma.es/" class=" img2 ">
              <img src="../assets/img/caosd_use.png"  alt="Profile">
            </a>
          </div>
          <div class="col-lg-3 d-md-flex ">
            <a target="_blank" href="https://www.uma.es/" class="img3" style="margin-top: 10%;">
              <img src="../assets/img/uma-logo-transparent.png" alt="Profile">
            </a>
          </div>
        </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<!-- End Header -->
<!-- ======= Sidebar ======= -->
<mat-drawer-container class="example-container" autosize>

<mat-drawer #drawer  class="color" mode="side">
  <button class="buttonmodal" style="background-color:#7c7c7c2f;margin-top: 3%; "(click)="showFM_Editor()">
    <h3 class="">FM Editor</h3>
  </button>  
  <div style="margin-top: 5%;"></div>
  <button  class="buttonmodal" style="background-color:#7c7c7c2f; margin-left: 15%;" (click)="showAbout()" >
    <h3 class="">About</h3>
  </button>

</mat-drawer>
<div class="resize">
  
<!-- Main Page About --> 
<div [hidden]="!windowAbout">
  <about></about>
</div>

<!-- Main Page FM_editor -->
<div [hidden]="!windowFM_Editor">
<main >
  <section class="section dashboard">
    <div class="row">
      <div style="margin-top: 2%; "></div>
      <!-- Card 1 -->
      <div   class="col-4">
        <div class="card block">
          <div class="border">
            <card1 (newItemEventreadThis)="readThis($event)" ></card1>
          </div>
        </div>
      </div>
      <!-- Card 2 -->
      <div   class="col-4">
        <div class="card block">
          <div class="border">
            <card2 [item]="item"  (newItemEventreturnValues)="returnValues($event)"></card2>
          </div>
        </div>
      </div>
      <!-- Card 3-->
      <div   class="col-4">
        <div class="card block">
          <div class="border">
            <card3   
            (newItemEventSaveJson)="SaveJson()"  
            (newItemEventSaveUVL)="SaveUVL()"
            ></card3>
          </div>
        </div>
      </div> 
      
      <!-- Features Tree -->  
      <div   class="col-6">
        <div class="card block">
          <div class="border">
            <FeatureTree
             [my_session]="my_session"
             [name]="name"
             [type]="type"
             [optional]="optional"
             [abstract]="abstract"
             [card_max]="card_max"
             [card_min]="card_min"
             [attributes]="attributes"
             [actualfather]="actualfather"
             [ListOfRefactors]="ListOfRefactors"
             [actual]="actual"  
             [tree]="tree" 
             [treeControl]="treeControl"
             [dataSource]="dataSource"
             (newItemEventactual)="select($event)"
             (newItemEventrefactor)="SelectChipRefactor($event,'node')"
            ></FeatureTree>
          </div>
        </div>
      </div>
                
      <!-- Info -->
      <div   class="col-6 ">
        <div class="card block">
          <div class="border">
            <Information 
            [ListOfRefactorsInfo]="ListOfRefactors"
            [jsonlanguage]="jsonlanguage"
            [ListLanguage]="ListLanguage" 
             ></Information>
          </div>
        </div>
      </div>


      



      <!-- Pruebas constraint -->
      <div   class="container">
        <div class="row">
          <!-- Constraints Text --> 
          <div class="col-6">
            <div class="card block">
              <div class="border">  
                <ConstraintsText 
                [visible_Constraint_list]="visible_Constraint_list" 
                [show_refacts_cons_only]="show_refacts_cons_only"
                [listnamesconstraints]="listnamesconstraints"
                [jsonconstraintTexto]="jsonconstraintTexto"
                [cons]="cons"
                [constraindataSource]="constraindataSource"
                [ListOfRefactors]="ListOfRefactors"
                [consactual]="consactual"
                [jsonconstraintextshort]="jsonconstraintextshort"
                (newItemEventposition)="updatePosition($event)"
                (newItemEventrefactor)="SelectChipRefactor($event,'cons')"
                ></ConstraintsText>  
              </div>
            </div>
          </div>

          <mat-menu #menuoptionsconstraintree="matMenu">
            <button class="empty"  style="color: #012970 " data-bs-toggle="modal" href="#sidebaroptionsconstraintree">Options</button>
          </mat-menu> 

          <!-- Constraints Tree -->
          <div class="col-6">
            <div class="card block">
              <div class="border">
                
                <ConstraintsTree
                  [visible_Constraint_list]="visible_Constraint_list"
                  [ListOfConstraint]="ListOfConstraint"
                  [position]="position"
                  [featureautocomplete]="featureautocomplete"
                  [namesFeatures]="namesFeatures"
                  [listnamesconstraints]="listnamesconstraints"
                  [npos]="npos"
                  [ncons]="ncons"
                  [jsonconstraintTexto]="jsonconstraintTexto"
                  [constraintreeControl]="constraintreeControl"
                  [constraindataSource]="constraindataSource"
                  [consactual]="consactual"
                  [consactualfather]="consactualfather"
                  [cons]="cons"
                  (newItemEventupdatecons)="SelectCons($event)"
                ></ConstraintsTree>
              </div>
            </div>

        <div>
          </div>
          
          </div>
        </div>
      </div>
    </div>
  </section>
</main>
</div>
</div>
</mat-drawer-container>





<!--Modal Tree-->
<!-- Modal Modify values-->
<div class="modal fade" id="sidebareditvalues" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
	<div class="modal-dialog modal-lg">
		<div class="modal-content">
			<div class="modal-header">
				<h4 class="modal-title" id="exampleModalLabel">Modify values</h4>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="col-10">
          <h5>Name
          <input  type="string" [(ngModel)]="name"></h5>
          <h6 [hidden]="!checkNameFeature()[0]" class="gray"> name already in use</h6>
          <hr>
          <h5>Type:
            {{type}}
            <button class="empty" (click)="visiblechipsfeatures=!visiblechipsfeatures">
            <mat-icon class="mat-icon-rtl-mirror">
              {{visiblechipsfeatures ? 'expand_more' : 'chevron_right'}}
            </mat-icon></button>
            <mat-list [hidden]="!visiblechipsfeatures">
              <mat-option *ngFor="let chip of listOfTypes" (click)="visiblechipsfeatures=!visiblechipsfeatures" (click)="ChangeType(chip)">{{chip}}</mat-option>
            </mat-list>
          </h5>
          <hr>

          <h5 [hidden]="cardhidden()" >Card min 
          <input  type="number" [(ngModel)]="card_min" (change)="checkcard_min_max()"><hr></h5>
          <h5 [hidden]="cardhidden()">Card max
          <input type="number" [(ngModel)]="card_max" (change)="checkcard_min_max()" >
          <hr></h5>
          <div [hidden]="checkcard_min_max() || cardhidden()"> Caution with the values <hr></div>
          
          <input class="form-check-input" type="checkbox" [(ngModel)]="optional" > optional
          <hr>
          <input class="form-check-input" type="checkbox" [(ngModel)]="abstract" > abstract
          <hr>
          <h5>Attributes (name: value)
          <button class="empty" (click)="CreateAttribtues()" >
            <mat-icon class="mat-icon-rtl-mirror">add</mat-icon>
          </button></h5>
          <div *ngFor="let valor of attributes"  >
            <input type="string" [(ngModel)]="valor.name">
            <input type="string" [(ngModel)]="valor.value">
            <button class="empty" (click)="deleteAttributes(valor)">
              <mat-icon class="mat-icon-rtl-mirror">clear</mat-icon>
            </button>
          </div>
          <hr>
          <h2 [hidden]="checkNameFeature()[1]" >Save Changes</h2>
          <h2 [hidden]="!checkNameFeature()[1]" >Not possible to Update</h2>
          <button (click)="ModifySelecction()" [disabled]="checkNameFeature()[1]" data-bs-toggle="modal" href="#loading" class="buttonmodal">update</button>
				</div>
			</div>
			<div class="modal-footer">
				<button type="button" class="buttonmodal"  data-bs-dismiss="modal">Close</button>
			</div>
		</div>
	</div>
</div>
<!-- Modal Create children-->
<div class="modal fade" id="sidebarcreatechild" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
	  <div class="modal-content">
	    <div class="modal-header">
		    <h4 class="modal-title" id="exampleModalLabel">Create children</h4>
 		    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
	    <div class="modal-body">
		    <div class="col-10">
          <h3>Name</h3>
          <input matInput  type="string" [(ngModel)]="name">
          <div></div>
          <button (click)="CreateChildren()" data-bs-dismiss="modal" class="buttonmodal">Create</button>
				  </div>
	 	  </div>
	    <div class="modal-footer">
	      <button type="button" class="buttonmodal" data-bs-dismiss="modal">Close</button>
      </div>
	  </div>
	</div>
</div>
<!-- Modal Create brother -->
<div class="modal fade" id="sidebarcreatebrother" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
	  <div class="modal-content">
		  <div class="modal-header">
			  <h4 class="modal-title" id="exampleModalLabel">Create brother</h4>
				  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
			</div>
			<div class="modal-body">
				<div class="col-10">
          <input matInput  type="string" [(ngModel)]="name">
          <button (click)="CreateBrother()" data-bs-dismiss="modal" class="buttonmodal">Create</button>
		  	</div>
			</div>
			<div class="modal-footer">
				<button type="button" class="buttonmodal" data-bs-dismiss="modal">Close</button>
			</div>
	  </div>
	</div>
</div>
<!-- Modal Delete-->
<div class="modal fade" id="sidebardeletebranch" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
		  <div class="modal-header">
        <h2 class="modal-title" id="exampleModalLabel">Delete node</h2>
		    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
	    </div>
	    <div class="modal-body">
	      <div class="col-10">
          <h4>Are you sure?</h4>
          <button (click)="DeleteNode()" class="buttonmodal" data-bs-dismiss="modal">Proceed</button>
			  </div>
	    </div>
      <div class="modal-footer">
	      <button type="button" class="buttonmodal" data-bs-dismiss="modal">Go back</button>
	    </div>
	  </div>
  </div>
</div>

<!--Modal Constraint-->
<div class="modal fade" id="sidebaroptionsconstraintree" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title" id="exampleModalLabel">Options</h4>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <label >{{jsonconstraintTexto[npos]}}</label>
      <div class="modal-body">
        <div class="col-12">
          <div class="row">
            <!-- Logic Chip -->
            <div class="col-6">
              <div class="bordermodal">
                <h5>Logic Term</h5>
                <mat-chip-list class="mat-chip-list-stacked"  >
                  <mat-chip *ngFor="let chip of typesofcons" (click)="SelectChipLogic(chip)" >
                    {{chip}}
                  </mat-chip>
                </mat-chip-list>
              </div>
            </div>
            <!-- Features Chip -->
            <div class="col-6">
              <div class="bordermodal">
                <h5>Features Term</h5>
                <input type="text" [(ngModel)]="featureautocomplete">
                <cdk-virtual-scroll-viewport [itemSize]="6 * 7" class="example-viewport" >
                  <mat-chip-list class="mat-chip-list-stacked" >
                    <mat-chip *ngFor="let chip of namesFeatures" (click)="SelectChipFeature(chip)"  [hidden]="AutocompleteFeatureTermChip(chip)">
                      {{chip}}
                    </mat-chip>
                  </mat-chip-list>
                </cdk-virtual-scroll-viewport>
              </div>
            </div>
          </div>
        </div>
        <!--Write list-->
        <div class="margin"></div>
        <div class="bordermodal">
          <p  >{{Writelist()}}</p>
          <button class="btn btn-secondary "  (click)="DeleteList()">Delete List</button>
        </div>
        <div class="col-12">
          <!--Buttons-->
          <div class="row">
            <div class="col-3"><button class="buttonmodal " data-bs-dismiss="modal" (click)="CreateConsBrother()"> Insert brother </button></div>
            <div class="col-3"><button class="buttonmodal " data-bs-dismiss="modal" (click)="CreateConsSon()"> Insert child </button></div>
            <div class="col-3"><button class="buttonmodal " data-bs-dismiss="modal" (click)="ModifyCons()"> Edit Constrain </button></div>
            <div class="col-3"><button class="buttonmodal " data-bs-dismiss="modal" (click)="DeleteCons()"> Delete Constrain </button></div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="buttonmodal" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>



<!--Menu options-->
<mat-menu #menumdel="matMenu">
  <button  class ="empty" (click) = "$event.stopPropagation()" (click)="show_refacts_features_only=!show_refacts_features_only" matTooltip="Highlight Refactorings"  >
    <i class="bi bi-eye-fill" [hidden]="show_refacts_features_only"></i>
    <i class="bi bi-eye-slash-fill" [hidden]="!show_refacts_features_only"></i>  
    </button>
  <a (click)="show_refacts_features_only=!show_refacts_features_only" style="cursor: pointer;" (click) = "$event.stopPropagation()" >Highlight Refactorings</a>
</mat-menu>

<!--Menu Constraints options-->
<mat-menu #menumodelcons="matMenu" >
  <button  class ="empty" (click) = "$event.stopPropagation()" (click)="show_refacts_cons_only=!show_refacts_cons_only" matTooltip="Highlight Refactorings"  >
  <i class="bi bi-eye-fill" [hidden]="show_refacts_cons_only"></i>
  <i class="bi bi-eye-slash-fill" [hidden]="!show_refacts_cons_only"></i>  
  </button>
  <a (click)="show_refacts_cons_only=!show_refacts_cons_only" (click) = "$event.stopPropagation()"  >Highlight Refactorings</a>
  <hr>
</mat-menu>




        <script type="text/javascript">
            // d3.json('fm_facts.json').then(drawFMFactTag);  
            var fmCharacterizationStr = `{{ data.fm_characterization_str | safe }}`;
            var fmCharacterizationJSONStr = `{{ data.fm_characterization_json_str | safe }}`;
            var fmFactsJSON = '{{ data.fm_facts | tojson | safe }}';
            var fmData = JSON.parse(fmFactsJSON);
            drawFMFactLabel(fmData);
        </script>








     
<!-- Modal loading-->
<div class="modal" #loading id="loading" data-bs-backdrop="static">
  <div class="modal-dialog modal-lg" >
    <div class="modal-content">
		  <div class="modal-header"> 
        <h2 class="modal-title" id="exampleModalLabel">Loading...</h2>
      </div>
      <h5>This could take some time </h5>
	    <div class="modal-body">
        <div class="row">
          <div class="col-2"></div>
          <img class="col-8"src={{showModal()[0]}} >
          <div class="col-1">{{showModal()[1]? '': buttonloadingclose.click()}}</div>
        </div>
	    </div>
      <button [hidden]="true" #buttonloadingclose data-bs-dismiss="modal" data-bs-backdrop="static"></button>
	  </div>
  </div>
</div>             

